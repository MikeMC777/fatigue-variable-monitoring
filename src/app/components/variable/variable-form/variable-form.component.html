<div class="justify-content-center row py-4">
  <div class="row form-wrapper px-xl-4 py-xl-2">
    <form onkeydown="return event.key != 'Enter'" *ngIf="loaded; else loading" [formGroup]="variableFormGroup" class="col-12">
      <div class="row">
        <div class="col-12 row">
          <div class="row pb-0 pb-md-4 mx-0 px-0">
            <div class="col-12 col-md-3 form-group-feedback text-truncate">
              <label class="mb-1" for="nameContent" matTooltip="Especifica el nombre de la variable. Después de creado, no podrá ser modificado." matTooltipPosition="right">Nombre</label>
              <ng-container *ngIf="router.url === '/form-variable'; then createName else editName">
              </ng-container>
              <ng-template #createName>
                <small class="text-danger" *ngIf="name.hasError('required') && name.touched">Campo requerido</small>
                <i *ngIf="!validName && name.touched && name.value != null" class="float-right text-danger fa fa-times"></i>
                <i *ngIf="validName && name.touched && name.value != null" class="float-right text-info fa fa-check"></i>
                <input autocomplete="off" id="nameContent" type="text" (keydown)="onTyping($event)"
                  (change)="validateName()" formControlName="name" aria-describedby="nameHelp"
                  class="form-control" [ngClass]="!validName && name.touched ? 'border-danger' : ''"
                  placeholder="Ingrese el nombre de la variable">
              </ng-template>
              <ng-template #editName>
                <input autocomplete="off" type="text" formControlName="name" class="form-control" id="nameContent" readonly>
              </ng-template>
            </div>
            <div class="col-12 col-md-3 mb-3 text-truncate">
              <label class="mb-1" for="dataTypeSelect" matTooltip="Especifica el tipo de dato que se almacenará para esta variable." matTooltipPosition="right">Tipo de dato</label>
              <select formControlName="data_type" class="form-control" id="dataTypeSelect" style="height: 2.4rem;">
                <option value="DEC">Decimal</option>
                <option value="INT">Entero</option>
              </select>
            </div>
            <div class="col-12 col-md-3 form-group-feedback text-truncate">
              <label class="mb-1" for="measurementUnitContent" matTooltip="Unidad de medida utilizado para esta variable." matTooltipPosition="right">Unidad de medida</label>
              <small class="text-danger" *ngIf="measurementUnit.hasError('maxlength')">Máximo 100 caracteres</small>
              <small class="text-danger" *ngIf="measurementUnit.hasError('required') && measurementUnit.touched">Campo requerido</small>
              <input formControlName="measurement_unit" autocomplete="off" type="text" aria-describedby="measurementUnitContentHelp" class="form-control" id="measurementUnitContent" placeholder="Ingrese la unidad de medida">
            </div>


            <div class="col-12 col-md-3 form-group-feedback text-truncate">
              <ng-container *ngIf="router.url === '/edit-variable'; then editStatus">
              </ng-container>
              <ng-template #editStatus>
                <section class="example-section">
                  <mat-checkbox class="example-margin py-3" formControlName="status">Activo</mat-checkbox>
                </section>
              </ng-template>
            </div>
            <div class="col-12 col-md-3 form-group-feedback text-truncate" *ngIf="router.url === '/edit-variable'">
              <section class="example-section">
                <mat-checkbox class="example-margin py-3" formControlName="has_range_for_age" (change)="hasAgeRangeChange($event)">¿Tiene rangos por edad?</mat-checkbox>
              </section>
            </div>
          </div>
          <div class="row pb-0 pb-md-4 mx-0 px-0" *ngIf="router.url === '/edit-variable' && !hasRangeForAge.value">
            <h2>Rangos asociados</h2>
            <span class="mb-2 mt-3">Defina los valores mínimos y máximos para considerar la medición de la variable dentro de lo normal</span>
            <div class="col-12 col-md-3 form-group-feedback text-truncate">
              <label class="mb-1" for="minRangeContent" matTooltip="Especifica el valor mínimo que puede tener la variable en las mediciones para decir que está dentro del rango normal." matTooltipPosition="right">Rango mínimo</label>
              <input formControlName="min_range" autocomplete="off" type="number" aria-describedby="minRangeContentHelp" class="form-control" id="minRangeContent" placeholder="Ingrese el rango mínimo">
            </div>
            <div class="col-12 col-md-3 form-group-feedback text-truncate">
              <label class="mb-1" for="maxRangeContent" matTooltip="Especifica el valor máximo que puede tener la variable en las mediciones para decir que está dentro del rango normal." matTooltipPosition="right">Rango máximo</label>
              <input formControlName="max_range" autocomplete="off" type="number" aria-describedby="maxRangeContentHelp" class="form-control" id="maxRangeContent" placeholder="Ingrese el rango máximo">
            </div>
          </div>
          <div *ngIf="router.url === '/edit-variable' && !!hasRangeForAge.value" class="row pb-0 pb-md-4 mx-0 px-0">
            <h2>Rangos asociados</h2>
            <fvm-variable-range-item
              class="col-6 d-flex justify-content-center" id="variable-range"
              *ngFor="let range of variableRanges"
              [variableRangeList]="variableRanges" [data]="range"
              (remove)="removeRange($event)"
              (add)="addRange($event)">
            </fvm-variable-range-item>
          </div>
        </div>
        <div class="col-12 button-container py-2">
          <button mat-raised-button class="btn btn-outline-danger mx-2" mat-button (click)="onCancel()">
            <i class="fa fa-times" aria-hidden="true"></i> Cancelar</button>
          <ng-container *ngIf="router.url === '/edit-variable'; then editVariableButton else createVariableButton">
          </ng-container>
          <ng-template #createVariableButton>
              <button mat-raised-button [disabled]="variableFormGroup.invalid || !validName || typing" class="btn btn-outline-success mx-2" mat-button (click)="onCreate(true)">
                <i class="fa fa-check-circle" aria-hidden="true"></i> Guardar</button>
              <button mat-raised-button [disabled]="variableFormGroup.invalid || !validName || typing" class="btn btn-outline-warning mx-2" mat-button (click)="onCreate()">
                <i class="fa fa-check-circle" aria-hidden="true"></i> Guardar y volver</button>
          </ng-template>
          <ng-template #editVariableButton>
              <button mat-raised-button [disabled]="variableFormGroup.invalid" class="btn btn-outline-success mx-2" mat-button (click)="onUpdate()">
                <i class="fa fa-check-circle" aria-hidden="true"></i> Guardar</button>
          </ng-template>
        </div>
      </div>
    </form>
    <ng-template #loading>
      <div class="d-block justify-content-center text-center m-5">
        <div class="spinner-grow text-info" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-secondary" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <div class="spinner-grow text-success" role="status">
          <span class="sr-only">Loading...</span>
        </div>
      </div>
    </ng-template>
  </div>
</div>

