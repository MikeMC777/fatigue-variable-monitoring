<div class="justify-content-center row py-4">
  <div class="row form-wrapper px-xl-4 py-xl-2">
    <form onkeydown="return event.key != 'Enter'" [formGroup]="reportFormGroup" class="col-12">
      <div class="row">
        <div class="col-12 row">
          <div class="row pb-0 pb-md-2 mx-0 px-0">
            <div class="col-12 col-md-3 mb-3 text-truncate">
              <label class="mb-1" for="employeeSelect" matTooltip="Empleado" matTooltipPosition="right">Empleado</label>
              <select class="form-control" id="employeeSelect" (change)="onChangeEmployeeSelect()"
                formControlName="employee_uuid" style="height: 2.4rem;">
                <option [value]="item._uuid" selected *ngFor="let item of employeeOptions"> {{item.name}} {{item.second_name}} {{item.surname}} {{item.second_surname}}
                </option>
              </select>
            </div>
            <div class="col-12 col-md-3 mb-3 text-truncate">
              <label class="mb-1" for="variableSelect" matTooltip="Variable" matTooltipPosition="right">Variable</label>
              <select class="form-control" id="variableSelect" (change)="onChangeVariableSelect()"
                formControlName="variable_uuid" style="height: 2.4rem;">
                <option [value]="item._uuid" selected *ngFor="let item of variableOptions"> {{item.name}}
                </option>
              </select>
            </div>
            <div class="col-12 col-md-3 mb-3 text-truncate">
              <label class="mb-1" for="sinceSelect" matTooltip="Desde hace" matTooltipPosition="right">Desde hace</label>
              <select formControlName="since" class="form-control" id="sinceSelect" style="height: 2.4rem;">
                <option value="1 HOUR">Una hora</option>
                <option value="2 HOUR">Dos horas</option>
                <option value="5 HOUR">Cinco horas</option>
                <option value="24 HOUR">Un día</option>
                <option value="1 WEEK">Una semana</option>
                <option value="1 MONTH">Un mes</option>
                <option value="1 YEAR">Un año</option>
              </select>
            </div>
            <div class="col-12 col-md-3 mb-3 text-truncate">
              <button mat-raised-button [disabled]="reportFormGroup.invalid" class="btn btn-outline-warning mx-2" mat-button (click)="onSearch()">
                <i class="fa fa-search" aria-hidden="true"></i> Buscar</button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
<fvm-line-chart *ngIf="loaded; else loading" [data]="dataForLineChart"></fvm-line-chart>
<div class="container py-4" *ngIf="loaded; else loading">
  <mat-form-field appearance="standard" class="mx-2">
    <mat-label>Buscar</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Ejemplo: Dispositivo" #input>
  </mat-form-field>
    <button mat-raised-button class="btn btn-outline-success mx-2 text-truncate" (click)="exporter.exportTable('xlsx', {fileName:'test', sheet: 'Reports', Props: {Author: 'Talha'}})">
      <i class="fa fa-file-excel-o" aria-hidden="true"></i> Excel</button>
    <button mat-raised-button class="btn btn-outline-primary mx-2 text-truncate" (click)="exporter.exportTable('csv')">
      <i class="fa fa-table" aria-hidden="true"></i> CSV</button>
    <button mat-raised-button class="btn btn-outline-warning mx-2 text-truncate" (click)="exporter.exportTable('json')">
      <i class="fa fa-file-code-o" aria-hidden="true"></i> JSON</button>
    <button mat-raised-button class="btn btn-outline-secondary mx-2 text-truncate" (click)="exporter.exportTable('txt')">
      <i class="fa fa-file-text-o" aria-hidden="true"></i> TXT</button>

  <table mat-table matTableExporter [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)" class="mat-elevation-z8" #exporter="matTableExporter">
    <!-- Id Column -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by id" class="bg-gray"> No. </th>
      <td mat-cell *matCellDef="let element"> {{element.id}}</td>
    </ng-container>

    <!-- Device Name Column -->
    <ng-container matColumnDef="device_name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by device name" class="bg-gray"> Dispositivo </th>
      <td mat-cell *matCellDef="let element"> {{element.device_name}}</td>
    </ng-container>

    <!-- Value Column -->
    <ng-container matColumnDef="value">
      <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by value" class="bg-gray"> Valor </th>
      <td mat-cell *matCellDef="let element"> {{element.value}}</td>
    </ng-container>

    <!-- Registered At Column -->
    <ng-container matColumnDef="registered_at">
      <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by registered at" class="bg-gray"> Fecha y hora registro </th>
      <td mat-cell *matCellDef="let element"> {{element.registered_at}}</td>
    </ng-container>
    <!-- Exceeds Range column -->
    <ng-container matColumnDef="exceeds_range">
      <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by exceeds range" class="bg-gray"> Medida dentro del rango normal </th>
      <td mat-cell *matCellDef="let element"><div *ngIf="element.exceeds_range; else inactive">
        <i class="fa fa-check text-success" aria-hidden="true"></i>
      </div>
      <ng-template #inactive><i class="fa fa-times text-danger" aria-hidden="true"></i></ng-template></td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"
        (click)="selection.toggle(row)">
    </tr>
  </table>

  <mat-paginator [pageSizeOptions]="[5, 10, 20]"
                 showFirstLastButtons
                 aria-label="Select page of reports">
  </mat-paginator>
</div>

<ng-template #loading>
  <div class="d-block justify-content-center text-center m-5">
    <div class="spinner-grow text-info" role="status">
      <span class="sr-only">Loading...</span>
    </div>
    <div class="spinner-grow text-secondary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
    <div class="spinner-grow text-success" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
</ng-template>
<div class="bottom-space"></div>
